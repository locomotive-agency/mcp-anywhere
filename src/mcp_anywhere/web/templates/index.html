{% extends "base.html" %}

{% block title %}MCP Anywhere - Dashboard{% endblock %}

{% block content %}
<!-- Page header -->
<div class="page-header">
    <h1 class="page-title">Configured Servers</h1>
    <p class="page-subtitle">Manage your MCP servers and connection settings</p>
</div>

<!-- MCP Server Status: compact strip -->
<div class="status-strip" id="mcp-status">
    <span class="status-dot" aria-hidden="true"></span>
    <div class="flex-1 min-w-0">
        <span class="font-semibold" style="color: var(--text-primary);">MCP Server Status</span>
        <span class="ml-3 text-sm" style="color: var(--text-secondary);">Running</span>
        <span class="ml-3 text-sm font-mono" style="color: var(--text-muted);">Transport: {{ transport_mode|upper }}</span>
    </div>
    <div class="flex items-center gap-2 flex-shrink-0">
        {% if transport_mode == 'stdio' %}
        <a href="/config/download" class="btn-primary inline-flex items-center px-3 py-1.5 text-xs">Download Config</a>
        <a href="/config/view" target="_blank" class="btn-info inline-flex items-center px-3 py-1.5 text-xs">View Config</a>
        <a href="/config/instructions" target="_blank" class="btn-action inline-flex items-center px-3 py-1.5 text-xs">Setup Instructions</a>
        {% else %}
        <button type="button" onclick="copyToClipboard('{{ request.url.scheme }}://{{ request.url.netloc }}/mcp')" class="btn-info inline-flex items-center px-3 py-1.5 text-xs">Copy</button>
        {% endif %}
    </div>
</div>

<!-- Connection details (expandable feel: same content, restyled) -->
<div class="ds-card mb-8" style="padding: var(--space-4);" id="mcp-connection-details">
        <h4 class="text-sm font-semibold mb-3" style="color: var(--text-secondary);">Connection Information</h4>
            
            {% if transport_mode == 'stdio' %}
                <div class="space-y-3">
                    <div class="p-3 rounded-lg" style="background-color: var(--color-brand-50); border: 1px solid var(--color-brand-200);">
                        <p class="text-sm mb-2" style="color: var(--color-brand-800);">
                            <strong>STDIO Mode Active</strong> - Ready for Claude Desktop integration
                        </p>
                        <div class="text-xs" style="color: var(--color-brand-700);">
                            <div><strong>Command:</strong> <code class="px-1 rounded" style="background-color: var(--color-brand-100);">python3 -m mcp_anywhere connect</code></div>
                            <div class="mt-2">
                                <strong>Note:</strong> MCP communication happens over standard I/O. 
                                The web UI is available for server management.
                            </div>
                        </div>
                    </div>
                    <div class="p-3 rounded-lg" style="background-color: var(--color-neutral-50); border: 1px solid var(--color-neutral-200);">
                        <p class="text-sm mb-2" style="color: var(--color-neutral-900);">
                            <strong>Claude Desktop Configuration</strong>
                        </p>
                        <div class="text-xs space-y-2" style="color: var(--text-secondary);">
                            <div>Download the configuration file to integrate with Claude Desktop:</div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="p-3 rounded-lg" style="background-color: var(--color-neutral-50); border: 1px solid var(--color-neutral-200);">
                    <p class="text-sm mb-2" style="color: var(--color-neutral-900);">
                        <strong>HTTP Mode Active</strong> - Ready for remote access
                    </p>
                    <div class="text-xs space-y-1" style="color: var(--text-secondary);">
                        <div><strong>MCP Endpoint:</strong> 
                            <span class="font-mono">{{ request.url.scheme }}://{{ request.url.netloc }}/mcp</span>
                        </div>
                    </div>
                </div>
            {% endif %}
</div>

{% if error %}
    <div class="mb-6 p-4 rounded-xl" style="background-color: #FEF2F2; color: #B91C1C; border: 1px solid #FECACA;">
        {{ error }}
    </div>
{% endif %}

{% if servers %}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for server in servers %}
        <div class="ds-card card-accent {% if server.is_active %}card-accent--active{% endif %}">
            <div class="mb-4">
                <h3 class="text-lg font-semibold mb-2" style="color: var(--text-primary);">{{ server.name }}</h3>
                
                {% if server.description %}
                <p class="text-sm mb-3 h-12 leading-4 overflow-hidden" style="color: var(--text-secondary); display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">{{ server.description }}</p>
                {% else %}
                <p class="text-sm mb-3 h-12 leading-4" style="color: var(--text-secondary);">&nbsp;</p>
                {% endif %}
                
                <div class="flex flex-wrap gap-2 mb-3">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                        {% if server.is_active %}badge-brand{% else %}bg-red-100 text-red-800{% endif %}">
                        {% if server.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                        {% if server.build_status == 'built' %}badge-neutral{% elif server.build_status == 'building' %}badge-warning{% else %}bg-red-100 text-red-800{% endif %}">
                        {{ server.build_status.title() }}
                    </span>
                    <span class="badge-neutral inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium">
                        {{ server.tools|length }} tools
                    </span>
                </div>
                
                <div class="text-xs space-y-1" style="color: var(--text-muted);">
                    <div><strong>Runtime:</strong> {{ server.runtime_type }}</div>
                    <div><strong>Repository:</strong> 
                        <a href="{{ server.github_url }}" target="_blank" class="link-brand" style="color: var(--brand-primary);">
                            {{ server.github_url.split('/')[-1] }}
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-2">
                <a href="/servers/{{ server.id }}" 
                   class="btn-info flex-1 text-sm font-medium py-2 px-3 text-center">
                    View Details
                </a>
                <form method="POST" action="/servers/{{ server.id }}/delete" 
                      onsubmit="return confirm('Are you sure you want to delete {{ server.name }}?')">
                    <button type="submit" 
                            class="text-sm font-medium py-2 px-3 rounded transition-colors" style="background-color: #EF4444; color: white;">
                        Delete
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <svg class="empty-state-icon mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
        <h3 class="empty-state-title">No servers configured yet</h3>
        <p class="empty-state-text">Get started by adding your first MCP server.</p>
        <a href="/servers/add" class="btn-primary inline-flex items-center px-5 py-2.5 text-sm font-medium">
            <svg class="mr-2 h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Add Your First Server
        </a>
    </div>
{% endif %}

{% endblock %}