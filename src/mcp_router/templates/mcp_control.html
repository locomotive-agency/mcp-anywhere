{% extends "base.html" %}

{% block title %}MCP Server Status{% endblock %}

{% block content %}
<div class="container mx-auto py-8">
    <h1 class="text-3xl font-bold mb-8">MCP Server Status</h1>
    
    <!-- Status Display -->
    <div id="server-status" class="mb-8" hx-get="/api/mcp/status" hx-trigger="load, every 5s">
        <div class="bg-gray-100 rounded-lg p-4">
            <p class="text-gray-500">Loading server status...</p>
        </div>
    </div>
    
    <!-- Information Panel -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold mb-4">About Transport Modes</h2>
        
        <div class="grid md:grid-cols-2 gap-6">
            <!-- STDIO Mode Information -->
            <div class="p-4 border border-gray-200 rounded-lg">
                <h3 class="text-lg font-semibold text-green-600 mb-2">
                    <svg class="inline w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    STDIO Mode
                </h3>
                <p class="text-sm text-gray-600 mb-3">
                    Optimized for local development with Claude Desktop. The MCP server runs via stdio transport 
                    while this web UI operates in the background for server management.
                </p>
                <div class="text-xs text-gray-500">
                    <strong>Best for:</strong> Local development, Claude Desktop integration<br>
                    <strong>Command:</strong> <code class="bg-gray-100 px-1 rounded">python -m mcp_router --transport stdio</code>
                </div>
            </div>
            
            <!-- HTTP Mode Information -->
            <div class="p-4 border border-gray-200 rounded-lg">
                <h3 class="text-lg font-semibold text-blue-600 mb-2">
                    <svg class="inline w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    HTTP Mode
                </h3>
                <p class="text-sm text-gray-600 mb-3">
                    Production-ready mode for remote access. Provides a unified HTTP server with both 
                    the MCP endpoint and web UI on a single port with OAuth 2.1 or API key authentication.
                </p>
                <div class="text-xs text-gray-500">
                    <strong>Best for:</strong> Production deployment, remote access, Claude Web<br>
                    <strong>Command:</strong> <code class="bg-gray-100 px-1 rounded">python -m mcp_router --transport http</code>
                </div>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
            <h4 class="text-sm font-semibold text-blue-900 mb-2">Transport Selection</h4>
            <p class="text-sm text-blue-800">
                The transport mode is determined at startup via the <code>--transport</code> flag or 
                <code>MCP_TRANSPORT</code> environment variable. This provides a clean separation between 
                local development and production deployment modes.
            </p>
        </div>
    </div>
</div>

<script>
// Store current status for comparison
let currentServerStatus = null;

// Handle status updates via htmx
document.body.addEventListener('htmx:afterSwap', function(event) {
    if (event.detail.target.id === 'server-status') {
        // Extract status data from the response
        const scriptTag = event.detail.target.querySelector('script[type="application/json"]');
        if (scriptTag) {
            try {
                const status = JSON.parse(scriptTag.textContent);
                currentServerStatus = status;
            } catch (e) {
                console.error('Failed to parse status data:', e);
            }
        }
    }
});

// Helper function to copy text to clipboard
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        // Show a temporary success message
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.classList.add('bg-green-600');
        button.classList.remove('bg-blue-600');
        
        setTimeout(() => {
            button.textContent = originalText;
            button.classList.remove('bg-green-600');
            button.classList.add('bg-blue-600');
        }, 2000);
    });
}
</script>
{% endblock %} 